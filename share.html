<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Experiencia BYD | Conduce el Futuro</title>
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            padding-top: 2rem;
        }

        .share-page {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        .main-img {
            width: 90%;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            margin-bottom: 2rem;
        }

        .btn-wa {
            background: #25D366;
        }
    </style>
</head>

<body>
    <div class="share-page">
        <header>
            <div class="logo">BYD AI</div>
        </header>

        <main id="share-content" style="display:none;">
            <h1 style="margin: 1.5rem 0 0.5rem;">隆Mira mi pr贸ximo BYD!</h1>
            <p style="color:var(--text-dim); margin-bottom: 2rem;">驴Listo para tu prueba de manejo?</p>

            <img id="result-img" class="main-img" src="" alt="Mi foto BYD">

            <div style="display:flex; flex-direction:column; gap:1rem; padding: 0 2rem;">
                <a id="download-link" href="" download="mi-byd.png" class="btn-primary"
                    style="text-decoration:none;">Descargar Foto</a>
                <a id="whatsapp-link" href="" target="_blank" class="btn-primary btn-wa"
                    style="text-decoration:none;">Compartir por WhatsApp</a>
                <a href="/" class="btn-back">Volver al inicio</a>
            </div>
        </main>

        <div id="loader-share" class="loader" style="margin: 5rem auto;"></div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // NOTA: Aqu铆 el frontend necesita las variables p煤blicas del .env
        // Para el MVP, si no tienes un bundler, podemos inyectarlas o Hardcodearlas 
        // pero lo ideal es que Netlify las inyecte.
        // Por ahora, asumiremos que las pondr谩s en este script o las leeremos de una config.
        const firebaseConfig = {
            apiKey: "AIzaSyA339PfmuQ0RSZAU79x6RgbiLGCvR9mPUo",
            authDomain: "byd1-692a1.firebaseapp.com",
            projectId: "byd1-692a1",
            messagingSenderId: "628122137367",
            appId: "1:628122137367:web:3ef018a680f54494a5bd52"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadPhoto() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (!id) return;

            const docRef = doc(db, "byd_activations", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                document.getElementById('result-img').src = data.generatedImageUrl;
                document.getElementById('download-link').href = data.generatedImageUrl;

                const waText = encodeURIComponent(`隆Mira c贸mo me veo conduciendo mi pr贸ximo ${data.carName}!  Generado con IA en la activaci贸n BYD.`);
                document.getElementById('whatsapp-link').href = `https://wa.me/?text=${waText}%20${window.location.href}`;

                document.getElementById('loader-share').style.display = 'none';
                document.getElementById('share-content').style.display = 'block';
            } else {
                alert("Foto no encontrada");
            }
        }

        loadPhoto();
    </script>
</body>

</html>